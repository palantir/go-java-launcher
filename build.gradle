buildscript {
    repositories {
        gradlePluginPortal()
    }

    dependencies {
        classpath 'com.palantir.gradle.externalpublish:gradle-external-publish-plugin:1.2.1'
        classpath 'com.palantir.gradle.gitversion:gradle-git-version:0.12.3'
    }
}

apply plugin: 'com.palantir.external-publish-dist'
apply plugin: 'com.palantir.git-version'

group 'com.palantir.launching'

version ((System.env.CIRCLE_TAG ?: gitVersion()).replaceAll('^v', ''))

task distTar(type: Tar) {
    compression Compression.GZIP

    ['darwin-amd64', 'linux-amd64', 'linux-arm64'].each { target ->
        into ("${project.version}/service/bin/$target") {
            from "out/dist/go-java-launcher/${project.version}/bin/go-java-launcher-${project.version}/service/bin/${project.version}/go-java-launcher"
        }
    }}
